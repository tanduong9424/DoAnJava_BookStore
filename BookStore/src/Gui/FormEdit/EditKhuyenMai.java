/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package Gui.FormEdit;

import Bus.Impl.KhuyenMailmpl;
import Dto.KHUYENMAI;
import com.github.lgooddatepicker.components.DatePicker;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.time.LocalDate;
import java.util.Date;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import static org.apache.logging.log4j.util.Strings.isBlank;

/**
 *
 * @author DELL
 */
public class EditKhuyenMai extends javax.swing.JFrame {
   
    KhuyenMailmpl khuyenMailmpl = new KhuyenMailmpl();
    /**
     * Creates new form EditKhuyenMai
     */
    public EditKhuyenMai() {
        this.setUndecorated(true);
        initComponents();
        this.setLocationRelativeTo(null);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        PanelAdd = new javax.swing.JPanel();
        mid = new javax.swing.JPanel();
        MaKM = new javax.swing.JTextField();
        StienCanThiet = new javax.swing.JTextField();
        PhanTramGiam = new javax.swing.JTextField();
        exit = new javax.swing.JLabel();
        ngaybatdau = new javax.swing.JTextField();
        ChonNgay1 = new javax.swing.JButton();
        ngaytao = new javax.swing.JTextField();
        ChonNgay2 = new javax.swing.JButton();
        ChonNgay3 = new javax.swing.JButton();
        ngayketthuc = new javax.swing.JTextField();
        bot = new javax.swing.JPanel();
        submitbtn = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        PanelAdd.setLayout(new java.awt.BorderLayout());

        mid.setBackground(new java.awt.Color(51, 255, 255));
        mid.setPreferredSize(new java.awt.Dimension(400, 396));

        MaKM.setEditable(false);
        MaKM.setBackground(new java.awt.Color(204, 255, 204));
        MaKM.setForeground(new java.awt.Color(0, 51, 51));
        MaKM.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Mã Khuyến Mãi", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Segoe UI", 1, 12), new java.awt.Color(0, 51, 51))); // NOI18N
        MaKM.setFocusable(false);

        StienCanThiet.setBackground(new java.awt.Color(204, 255, 204));
        StienCanThiet.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Tổng tiền cần thiết", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Segoe UI", 1, 12), new java.awt.Color(0, 51, 51))); // NOI18N

        PhanTramGiam.setBackground(new java.awt.Color(204, 255, 204));
        PhanTramGiam.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Phần trăm(%) giảm", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Segoe UI", 1, 12), new java.awt.Color(0, 51, 51))); // NOI18N

        exit.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/icons8_cancel_30px_1.png"))); // NOI18N
        exit.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                exitMouseClicked(evt);
            }
        });

        ngaybatdau.setEditable(false);
        ngaybatdau.setBackground(new java.awt.Color(204, 255, 204));
        ngaybatdau.setForeground(new java.awt.Color(0, 51, 51));
        ngaybatdau.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Ngày bắt đầu", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Segoe UI", 1, 12), new java.awt.Color(0, 51, 51))); // NOI18N
        ngaybatdau.setFocusable(false);
        ngaybatdau.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ngaybatdauActionPerformed(evt);
            }
        });

        ChonNgay1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/icons8_calendar_31_30px.png"))); // NOI18N
        ChonNgay1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ChonNgay1ActionPerformed(evt);
            }
        });

        ngaytao.setEditable(false);
        ngaytao.setBackground(new java.awt.Color(204, 255, 204));
        ngaytao.setForeground(new java.awt.Color(0, 51, 51));
        ngaytao.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Ngày tạo Khuyến mãi", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Segoe UI", 1, 12), new java.awt.Color(0, 51, 51))); // NOI18N
        ngaytao.setFocusable(false);
        ngaytao.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ngaytaoActionPerformed(evt);
            }
        });

        ChonNgay2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/icons8_calendar_31_30px.png"))); // NOI18N
        ChonNgay2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ChonNgay2ActionPerformed(evt);
            }
        });

        ChonNgay3.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/icons8_calendar_31_30px.png"))); // NOI18N
        ChonNgay3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ChonNgay3ActionPerformed(evt);
            }
        });

        ngayketthuc.setEditable(false);
        ngayketthuc.setBackground(new java.awt.Color(204, 255, 204));
        ngayketthuc.setForeground(new java.awt.Color(0, 51, 51));
        ngayketthuc.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Ngày kết thúc", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Segoe UI", 1, 12), new java.awt.Color(0, 51, 51))); // NOI18N
        ngayketthuc.setFocusable(false);
        ngayketthuc.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ngayketthucActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout midLayout = new javax.swing.GroupLayout(mid);
        mid.setLayout(midLayout);
        midLayout.setHorizontalGroup(
            midLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, midLayout.createSequentialGroup()
                .addGap(109, 109, 109)
                .addGroup(midLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(PhanTramGiam)
                    .addGroup(midLayout.createSequentialGroup()
                        .addGroup(midLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(StienCanThiet)
                            .addComponent(MaKM, javax.swing.GroupLayout.DEFAULT_SIZE, 187, Short.MAX_VALUE)
                            .addComponent(ngaytao)
                            .addComponent(ngaybatdau)
                            .addComponent(ngayketthuc))
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addGap(5, 5, 5)
                .addGroup(midLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(midLayout.createSequentialGroup()
                        .addGroup(midLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(ChonNgay2, javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(ChonNgay1, javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(ChonNgay3, javax.swing.GroupLayout.Alignment.LEADING))
                        .addGap(62, 62, 62))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, midLayout.createSequentialGroup()
                        .addComponent(exit, javax.swing.GroupLayout.PREFERRED_SIZE, 37, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(28, 28, 28))))
        );
        midLayout.setVerticalGroup(
            midLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(midLayout.createSequentialGroup()
                .addGroup(midLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(midLayout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(MaKM, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(exit))
                .addGap(5, 5, 5)
                .addGroup(midLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(midLayout.createSequentialGroup()
                        .addComponent(StienCanThiet, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(5, 5, 5)
                        .addComponent(PhanTramGiam, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(5, 5, 5)
                        .addGroup(midLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(midLayout.createSequentialGroup()
                                .addGroup(midLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(ngaytao, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(ChonNgay1))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(ngaybatdau, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(ChonNgay2))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(ngayketthuc, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(ChonNgay3))
                .addContainerGap(133, Short.MAX_VALUE))
        );

        PanelAdd.add(mid, java.awt.BorderLayout.CENTER);

        submitbtn.setBackground(new java.awt.Color(255, 255, 255));
        submitbtn.setFont(new java.awt.Font("Segoe UI", 1, 18)); // NOI18N
        submitbtn.setForeground(new java.awt.Color(0, 51, 51));
        submitbtn.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        submitbtn.setText("Xác Nhận");
        submitbtn.setOpaque(true);
        submitbtn.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                submitbtnMouseClicked(evt);
            }
        });

        javax.swing.GroupLayout botLayout = new javax.swing.GroupLayout(bot);
        bot.setLayout(botLayout);
        botLayout.setHorizontalGroup(
            botLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(submitbtn, javax.swing.GroupLayout.DEFAULT_SIZE, 400, Short.MAX_VALUE)
        );
        botLayout.setVerticalGroup(
            botLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(submitbtn, javax.swing.GroupLayout.DEFAULT_SIZE, 37, Short.MAX_VALUE)
        );

        PanelAdd.add(bot, java.awt.BorderLayout.PAGE_END);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 412, Short.MAX_VALUE)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                    .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(PanelAdd, javax.swing.GroupLayout.PREFERRED_SIZE, 400, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 449, Short.MAX_VALUE)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                    .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(PanelAdd, javax.swing.GroupLayout.PREFERRED_SIZE, 437, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void exitMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_exitMouseClicked
        // TODO add your handling code here:
        this.dispose();
    }//GEN-LAST:event_exitMouseClicked

    private void ngaybatdauActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ngaybatdauActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_ngaybatdauActionPerformed

    private void ChonNgay1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ChonNgay1ActionPerformed
        // TODO add your handling code here:
        DatePicker datePicker = new DatePicker();
        datePicker.setDateToToday();//đặt mặc định là hôm nay
        datePicker.addDateChangeListener((dce) -> {
            ngaytao.setText(datePicker.getDateStringOrEmptyString());
        });
        JOptionPane.showMessageDialog(this, datePicker, "Chọn ngày tạo khuyến mãi", JOptionPane.PLAIN_MESSAGE);
    }//GEN-LAST:event_ChonNgay1ActionPerformed

    private void ngaytaoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ngaytaoActionPerformed
        // TODO add your handling code here:

    }//GEN-LAST:event_ngaytaoActionPerformed

    private void ChonNgay2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ChonNgay2ActionPerformed
        // TODO add your handling code here:
        DatePicker datePicker = new DatePicker();
        datePicker.setDateToToday();//đặt mặc định là hôm nay
        datePicker.addDateChangeListener((dce) -> {
            ngaybatdau.setText(datePicker.getDateStringOrEmptyString());
        });
        JOptionPane.showMessageDialog(this, datePicker, "Chọn ngày bắt đầu", JOptionPane.PLAIN_MESSAGE);
    }//GEN-LAST:event_ChonNgay2ActionPerformed

    private void ChonNgay3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ChonNgay3ActionPerformed
        // TODO add your handling code here:
        DatePicker datePicker = new DatePicker();
        datePicker.setDateToToday();//đặt mặc định là hôm nay
        datePicker.addDateChangeListener((dce) -> {
            ngayketthuc.setText(datePicker.getDateStringOrEmptyString());
        });
        JOptionPane.showMessageDialog(this, datePicker, "Chọn ngày kết thúc", JOptionPane.PLAIN_MESSAGE);
    }//GEN-LAST:event_ChonNgay3ActionPerformed

    private void ngayketthucActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ngayketthucActionPerformed
        // TODO add your handling code here:

    }//GEN-LAST:event_ngayketthucActionPerformed

    private void submitbtnMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_submitbtnMouseClicked
        // TODO add your handling code here:
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
        
        Date date1 = null;
        Date date2 = null;
        Date date3 = null;
        
        try {
            date1 = dateFormat.parse(ngaytao.getText());
            date2 = dateFormat.parse(ngaybatdau.getText());
            date3 = dateFormat.parse(ngayketthuc.getText());
        } catch (ParseException ex) {
            
        }
        java.sql.Date sqlDate1 = new java.sql.Date(date1.getTime());
        java.sql.Date sqlDate2 = new java.sql.Date(date2.getTime());
        java.sql.Date sqlDate3 = new java.sql.Date(date3.getTime());
        
        String idKm = MaKM.getText();
        if (isBlank(idKm)) {
            JOptionPane.showMessageDialog(this, "Lỗi Id", "Lỗi", JOptionPane.ERROR_MESSAGE);
            return;
        }
        int idKmInt;
        try {
            idKmInt = Integer.parseInt(idKm);
        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(null, "Phần trăm giảm giá nhập không hợp lệ.", "Lỗi", JOptionPane.ERROR_MESSAGE);
            return;
        }
        String tongtien = StienCanThiet.getText();
        if (isBlank(tongtien)) {
            JOptionPane.showMessageDialog(this, "Vui lòng nhập tổng tiền cần thiết", "Lỗi", JOptionPane.ERROR_MESSAGE);
            return;
        }
        String phantram = PhanTramGiam.getText();
        if (isBlank(phantram)) {
            JOptionPane.showMessageDialog(this, "Vui Lòng Nhập phần trăm giảm gía", "Lỗi", JOptionPane.ERROR_MESSAGE);
            return;
        }
        int phantramInt,tongtienInt;
        try {
            phantramInt = Integer.parseInt(phantram);
        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(null, "Phần trăm giảm giá nhập không hợp lệ.", "Lỗi", JOptionPane.ERROR_MESSAGE);
            return;
        }
        try {
            tongtienInt = Integer.parseInt(tongtien);
        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(null, "Tổng tiền cần thiết nhập không hợp lệ.", "Lỗi", JOptionPane.ERROR_MESSAGE);
            return;
        }
        KHUYENMAI km =new KHUYENMAI(idKmInt,sqlDate1,sqlDate2,sqlDate3,tongtienInt,phantramInt,true);
        khuyenMailmpl.updateKhuyenMai(km);
        this.dispose();
    }//GEN-LAST:event_submitbtnMouseClicked
    public void setData(String makm,String stien,String percent,String ngaytaokm,String ngaybatdaukm,String ngayketthuckm ){
        MaKM.setText(makm);
        StienCanThiet.setText(stien);
        PhanTramGiam.setText(percent);
        ngaytao.setText(ngaytaokm);
        ngaybatdau.setText(ngaybatdaukm);
        ngayketthuc.setText(ngayketthuckm);
    }
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(EditKhuyenMai.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(EditKhuyenMai.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(EditKhuyenMai.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(EditKhuyenMai.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new EditKhuyenMai().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton ChonNgay1;
    private javax.swing.JButton ChonNgay2;
    private javax.swing.JButton ChonNgay3;
    private javax.swing.JTextField MaKM;
    private javax.swing.JPanel PanelAdd;
    private javax.swing.JTextField PhanTramGiam;
    private javax.swing.JTextField StienCanThiet;
    private javax.swing.JPanel bot;
    private javax.swing.JLabel exit;
    private javax.swing.JPanel mid;
    private javax.swing.JTextField ngaybatdau;
    private javax.swing.JTextField ngayketthuc;
    private javax.swing.JTextField ngaytao;
    private javax.swing.JLabel submitbtn;
    // End of variables declaration//GEN-END:variables
}
